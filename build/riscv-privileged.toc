\contentsline {chapter}{Preface}{i}{Doc-Start}%
\contentsline {chapter}{\numberline {第一章\hspace {.3em}}Introduction}{1}{chapter.1}%
\contentsline {section}{\numberline {1.1}RISC-V Privileged Software Stack Terminology}{1}{section.1.1}%
\contentsline {section}{\numberline {1.2}Privilege Levels}{3}{section.1.2}%
\contentsline {section}{\numberline {1.3}Debug Mode}{4}{section.1.3}%
\contentsline {chapter}{\numberline {第二章\hspace {.3em}}Control and Status Registers (CSRs)}{5}{chapter.2}%
\contentsline {section}{\numberline {2.1}CSR Address Mapping Conventions}{5}{section.2.1}%
\contentsline {section}{\numberline {2.2}CSR Listing}{6}{section.2.2}%
\contentsline {section}{\numberline {2.3}CSR Field Specifications}{13}{section.2.3}%
\contentsline {section}{\numberline {2.4}CSR Field Modulation}{14}{section.2.4}%
\contentsline {section}{\numberline {2.5}Implicit Reads of CSRs}{15}{section.2.5}%
\contentsline {section}{\numberline {2.6}CSR Width Modulation}{15}{section.2.6}%
\contentsline {chapter}{\numberline {第三章\hspace {.3em}}Machine-Level ISA, Version 1.12}{17}{chapter.3}%
\contentsline {section}{\numberline {3.1}Machine-Level CSRs}{17}{section.3.1}%
\contentsline {subsection}{\numberline {3.1.1}Machine ISA Register {\tt misa}}{17}{subsection.3.1.1}%
\contentsline {subsection}{\numberline {3.1.2}Machine Vendor ID Register {\tt mvendorid}}{21}{subsection.3.1.2}%
\contentsline {subsection}{\numberline {3.1.3}Machine Architecture ID Register {\tt marchid}}{21}{subsection.3.1.3}%
\contentsline {subsection}{\numberline {3.1.4}Machine Implementation ID Register {\tt mimpid}}{22}{subsection.3.1.4}%
\contentsline {subsection}{\numberline {3.1.5}Hart ID Register {\tt mhartid}}{23}{subsection.3.1.5}%
\contentsline {subsection}{\numberline {3.1.6}Machine Status Registers ({\tt mstatus} and {\tt mstatush})}{23}{subsection.3.1.6}%
\contentsline {subsubsection}{\numberline {3.1.6.1}Privilege and Global Interrupt-Enable Stack in {\tt mstatus} register}{24}{subsubsection.3.1.6.1}%
\contentsline {subsubsection}{\numberline {3.1.6.2}Base ISA Control in {\tt mstatus} Register}{25}{subsubsection.3.1.6.2}%
\contentsline {subsubsection}{\numberline {3.1.6.3}Memory Privilege in {\tt mstatus} Register}{26}{subsubsection.3.1.6.3}%
\contentsline {subsubsection}{\numberline {3.1.6.4}Endianness Control in {\tt mstatus} and {\tt mstatush} Registers}{27}{subsubsection.3.1.6.4}%
\contentsline {subsubsection}{\numberline {3.1.6.5}Virtualization Support in {\tt mstatus} Register}{29}{subsubsection.3.1.6.5}%
\contentsline {subsubsection}{\numberline {3.1.6.6}Extension Context Status in {\tt mstatus} Register}{30}{subsubsection.3.1.6.6}%
\contentsline {subsection}{\numberline {3.1.7}Machine Trap-Vector Base-Address Register ({\tt mtvec})}{35}{subsection.3.1.7}%
\contentsline {subsection}{\numberline {3.1.8}Machine Trap Delegation Registers ({\tt medeleg} and {\tt mideleg})}{36}{subsection.3.1.8}%
\contentsline {subsection}{\numberline {3.1.9}Machine Interrupt Registers ({\tt mip} and {\tt mie})}{38}{subsection.3.1.9}%
\contentsline {subsection}{\numberline {3.1.10}Hardware Performance Monitor}{41}{subsection.3.1.10}%
\contentsline {subsection}{\numberline {3.1.11}Machine Counter-Enable Register ({\tt mcounteren})}{42}{subsection.3.1.11}%
\contentsline {subsection}{\numberline {3.1.12}Machine Counter-Inhibit CSR ({\tt mcountinhibit})}{43}{subsection.3.1.12}%
\contentsline {subsection}{\numberline {3.1.13}Machine Scratch Register ({\tt mscratch})}{44}{subsection.3.1.13}%
\contentsline {subsection}{\numberline {3.1.14}Machine Exception Program Counter ({\tt mepc})}{45}{subsection.3.1.14}%
\contentsline {subsection}{\numberline {3.1.15}Machine Cause Register ({\tt mcause})}{45}{subsection.3.1.15}%
\contentsline {subsection}{\numberline {3.1.16}Machine Trap Value Register ({\tt mtval})}{49}{subsection.3.1.16}%
\contentsline {subsection}{\numberline {3.1.17}Machine Configuration Pointer Register ({\tt mconfigptr})}{50}{subsection.3.1.17}%
\contentsline {subsection}{\numberline {3.1.18}Machine Environment Configuration Registers ({\tt menvcfg} and {\tt menvcfgh})}{51}{subsection.3.1.18}%
\contentsline {subsection}{\numberline {3.1.19}Machine Security Configuration Register ({\tt mseccfg})}{53}{subsection.3.1.19}%
\contentsline {section}{\numberline {3.2}Machine-Level Memory-Mapped Registers}{53}{section.3.2}%
\contentsline {subsection}{\numberline {3.2.1}Machine Timer Registers ({\tt mtime} and {\tt mtimecmp})}{53}{subsection.3.2.1}%
\contentsline {section}{\numberline {3.3}Machine-Mode Privileged Instructions}{55}{section.3.3}%
\contentsline {subsection}{\numberline {3.3.1}Environment Call and Breakpoint}{55}{subsection.3.3.1}%
\contentsline {subsection}{\numberline {3.3.2}Trap-Return Instructions}{56}{subsection.3.3.2}%
\contentsline {subsection}{\numberline {3.3.3}Wait for Interrupt}{57}{subsection.3.3.3}%
\contentsline {subsection}{\numberline {3.3.4}Custom SYSTEM Instructions}{58}{subsection.3.3.4}%
\contentsline {section}{\numberline {3.4}Reset}{59}{section.3.4}%
\contentsline {section}{\numberline {3.5}Non-Maskable Interrupts}{59}{section.3.5}%
\contentsline {section}{\numberline {3.6}Physical Memory Attributes}{60}{section.3.6}%
\contentsline {subsection}{\numberline {3.6.1}Main Memory versus I/O versus Vacant Regions}{61}{subsection.3.6.1}%
\contentsline {subsection}{\numberline {3.6.2}Supported Access Type PMAs}{62}{subsection.3.6.2}%
\contentsline {subsection}{\numberline {3.6.3}Atomicity PMAs}{62}{subsection.3.6.3}%
\contentsline {subsubsection}{\numberline {3.6.3.1}AMO PMA}{63}{subsubsection.3.6.3.1}%
\contentsline {subsubsection}{\numberline {3.6.3.2}Reservability PMA}{63}{subsubsection.3.6.3.2}%
\contentsline {subsubsection}{\numberline {3.6.3.3}Alignment}{64}{subsubsection.3.6.3.3}%
\contentsline {subsection}{\numberline {3.6.4}Memory-Ordering PMAs}{64}{subsection.3.6.4}%
\contentsline {subsection}{\numberline {3.6.5}Coherence and Cacheability PMAs}{65}{subsection.3.6.5}%
\contentsline {subsection}{\numberline {3.6.6}Idempotency PMAs}{67}{subsection.3.6.6}%
\contentsline {section}{\numberline {3.7}Physical Memory Protection}{68}{section.3.7}%
\contentsline {subsection}{\numberline {3.7.1}Physical Memory Protection CSRs}{68}{subsection.3.7.1}%
\contentsline {subsection}{\numberline {3.7.2}Physical Memory Protection and Paging}{73}{subsection.3.7.2}%
\contentsline {chapter}{\numberline {第四章\hspace {.3em}}Supervisor-Level ISA, Version 1.12}{75}{chapter.4}%
\contentsline {section}{\numberline {4.1}Supervisor CSRs}{75}{section.4.1}%
\contentsline {subsection}{\numberline {4.1.1}Supervisor Status Register (\tt sstatus)}{75}{subsection.4.1.1}%
\contentsline {subsubsection}{\numberline {4.1.1.1}Base ISA Control in {\tt sstatus} Register}{77}{subsubsection.4.1.1.1}%
\contentsline {subsubsection}{\numberline {4.1.1.2}Memory Privilege in {\tt sstatus} Register}{77}{subsubsection.4.1.1.2}%
\contentsline {subsubsection}{\numberline {4.1.1.3}Endianness Control in {\tt sstatus} Register}{78}{subsubsection.4.1.1.3}%
\contentsline {subsection}{\numberline {4.1.2}Supervisor Trap Vector Base Address Register ({\tt stvec})}{78}{subsection.4.1.2}%
\contentsline {subsection}{\numberline {4.1.3}Supervisor Interrupt Registers ({\tt sip} and {\tt sie})}{79}{subsection.4.1.3}%
\contentsline {subsection}{\numberline {4.1.4}Supervisor Timers and Performance Counters}{81}{subsection.4.1.4}%
\contentsline {subsection}{\numberline {4.1.5}Counter-Enable Register ({\tt scounteren})}{81}{subsection.4.1.5}%
\contentsline {subsection}{\numberline {4.1.6}Supervisor Scratch Register ({\tt sscratch})}{82}{subsection.4.1.6}%
\contentsline {subsection}{\numberline {4.1.7}Supervisor Exception Program Counter ({\tt sepc})}{82}{subsection.4.1.7}%
\contentsline {subsection}{\numberline {4.1.8}Supervisor Cause Register ({\tt scause})}{83}{subsection.4.1.8}%
\contentsline {subsection}{\numberline {4.1.9}Supervisor Trap Value ({\tt stval}) Register}{83}{subsection.4.1.9}%
\contentsline {subsection}{\numberline {4.1.10}Supervisor Environment Configuration Register ({\tt senvcfg})}{85}{subsection.4.1.10}%
\contentsline {subsection}{\numberline {4.1.11}Supervisor Address Translation and Protection ({\tt satp}) Register}{87}{subsection.4.1.11}%
\contentsline {section}{\numberline {4.2}Supervisor Instructions}{90}{section.4.2}%
\contentsline {subsection}{\numberline {4.2.1}Supervisor Memory-Management Fence Instruction}{90}{subsection.4.2.1}%
\contentsline {section}{\numberline {4.3}Sv32: Page-Based 32-bit Virtual-Memory Systems}{94}{section.4.3}%
\contentsline {subsection}{\numberline {4.3.1}Addressing and Memory Protection}{95}{subsection.4.3.1}%
\contentsline {subsection}{\numberline {4.3.2}Virtual Address Translation Process}{98}{subsection.4.3.2}%
\contentsline {section}{\numberline {4.4}Sv39: Page-Based 39-bit Virtual-Memory System}{101}{section.4.4}%
\contentsline {subsection}{\numberline {4.4.1}Addressing and Memory Protection}{101}{subsection.4.4.1}%
\contentsline {section}{\numberline {4.5}Sv48: Page-Based 48-bit Virtual-Memory System}{103}{section.4.5}%
\contentsline {subsection}{\numberline {4.5.1}Addressing and Memory Protection}{103}{subsection.4.5.1}%
\contentsline {section}{\numberline {4.6}Sv57: Page-Based 57-bit Virtual-Memory System}{104}{section.4.6}%
\contentsline {subsection}{\numberline {4.6.1}Addressing and Memory Protection}{104}{subsection.4.6.1}%
\contentsline {chapter}{\numberline {第五章\hspace {.3em}}``Svnapot'' Standard Extension for NAPOT Translation Contiguity, Version 1.0}{107}{chapter.5}%
\contentsline {chapter}{\numberline {第六章\hspace {.3em}}``Svpbmt'' Standard Extension for Page-Based Memory Types, Version 1.0}{111}{chapter.6}%
\contentsline {chapter}{\numberline {第七章\hspace {.3em}}``Svinval'' Standard Extension for Fine-Grained Address-Translation Cache Invalidation, Version 1.0}{115}{chapter.7}%
\contentsline {chapter}{\numberline {第八章\hspace {.3em}}Hypervisor Extension, Version 1.0}{119}{chapter.8}%
\contentsline {section}{\numberline {8.1}Privilege Modes}{120}{section.8.1}%
\contentsline {section}{\numberline {8.2}Hypervisor and Virtual Supervisor CSRs}{121}{section.8.2}%
\contentsline {subsection}{\numberline {8.2.1}Hypervisor Status Register ({\tt hstatus})}{122}{subsection.8.2.1}%
\contentsline {subsection}{\numberline {8.2.2}Hypervisor Trap Delegation Registers ({\tt hedeleg} and {\tt hideleg})}{124}{subsection.8.2.2}%
\contentsline {subsection}{\numberline {8.2.3}Hypervisor Interrupt Registers ({\tt hvip}, {\tt hip}, and {\tt hie})}{126}{subsection.8.2.3}%
\contentsline {subsection}{\numberline {8.2.4}Hypervisor Guest External Interrupt Registers ({\tt hgeip} and {\tt hgeie})}{128}{subsection.8.2.4}%
\contentsline {subsection}{\numberline {8.2.5}Hypervisor Environment Configuration Registers ({\tt henvcfg} and {\tt henvcfgh})}{129}{subsection.8.2.5}%
\contentsline {subsection}{\numberline {8.2.6}Hypervisor Counter-Enable Register ({\tt hcounteren})}{130}{subsection.8.2.6}%
\contentsline {subsection}{\numberline {8.2.7}Hypervisor Time Delta Registers ({\tt htimedelta}, {\tt htimedeltah})}{131}{subsection.8.2.7}%
\contentsline {subsection}{\numberline {8.2.8}Hypervisor Trap Value Register ({\tt htval})}{132}{subsection.8.2.8}%
\contentsline {subsection}{\numberline {8.2.9}Hypervisor Trap Instruction Register ({\tt htinst})}{133}{subsection.8.2.9}%
\contentsline {subsection}{\numberline {8.2.10}Hypervisor Guest Address Translation and Protection Register ({\tt hgatp})}{133}{subsection.8.2.10}%
\contentsline {subsection}{\numberline {8.2.11}Virtual Supervisor Status Register ({\tt vsstatus})}{135}{subsection.8.2.11}%
\contentsline {subsection}{\numberline {8.2.12}Virtual Supervisor Interrupt Registers ({\tt vsip} and {\tt vsie})}{137}{subsection.8.2.12}%
\contentsline {subsection}{\numberline {8.2.13}Virtual Supervisor Trap Vector Base Address Register ({\tt vstvec})}{138}{subsection.8.2.13}%
\contentsline {subsection}{\numberline {8.2.14}Virtual Supervisor Scratch Register ({\tt vsscratch})}{138}{subsection.8.2.14}%
\contentsline {subsection}{\numberline {8.2.15}Virtual Supervisor Exception Program Counter ({\tt vsepc})}{138}{subsection.8.2.15}%
\contentsline {subsection}{\numberline {8.2.16}Virtual Supervisor Cause Register ({\tt vscause})}{139}{subsection.8.2.16}%
\contentsline {subsection}{\numberline {8.2.17}Virtual Supervisor Trap Value Register ({\tt vstval})}{139}{subsection.8.2.17}%
\contentsline {subsection}{\numberline {8.2.18}Virtual Supervisor Address Translation and Protection Register ({\tt vsatp})}{140}{subsection.8.2.18}%
\contentsline {section}{\numberline {8.3}Hypervisor Instructions}{141}{section.8.3}%
\contentsline {subsection}{\numberline {8.3.1}Hypervisor Virtual-Machine Load and Store Instructions}{141}{subsection.8.3.1}%
\contentsline {subsection}{\numberline {8.3.2}Hypervisor Memory-Management Fence Instructions}{142}{subsection.8.3.2}%
\contentsline {section}{\numberline {8.4}Machine-Level CSRs}{144}{section.8.4}%
\contentsline {subsection}{\numberline {8.4.1}Machine Status Registers ({\tt mstatus} and {\tt mstatush})}{144}{subsection.8.4.1}%
\contentsline {subsection}{\numberline {8.4.2}Machine Interrupt Delegation Register ({\tt mideleg})}{147}{subsection.8.4.2}%
\contentsline {subsection}{\numberline {8.4.3}Machine Interrupt Registers ({\tt mip} and {\tt mie})}{147}{subsection.8.4.3}%
\contentsline {subsection}{\numberline {8.4.4}Machine Second Trap Value Register ({\tt mtval2})}{148}{subsection.8.4.4}%
\contentsline {subsection}{\numberline {8.4.5}Machine Trap Instruction Register ({\tt mtinst})}{149}{subsection.8.4.5}%
\contentsline {section}{\numberline {8.5}Two-Stage Address Translation}{149}{section.8.5}%
\contentsline {subsection}{\numberline {8.5.1}Guest Physical Address Translation}{150}{subsection.8.5.1}%
\contentsline {subsection}{\numberline {8.5.2}Guest-Page Faults}{152}{subsection.8.5.2}%
\contentsline {subsection}{\numberline {8.5.3}Memory-Management Fences}{153}{subsection.8.5.3}%
\contentsline {section}{\numberline {8.6}Traps}{154}{section.8.6}%
\contentsline {subsection}{\numberline {8.6.1}Trap Cause Codes}{154}{subsection.8.6.1}%
\contentsline {subsection}{\numberline {8.6.2}Trap Entry}{158}{subsection.8.6.2}%
\contentsline {subsection}{\numberline {8.6.3}Transformed Instruction or Pseudoinstruction for {\tt mtinst} or {\tt htinst}}{159}{subsection.8.6.3}%
\contentsline {subsection}{\numberline {8.6.4}Trap Return}{164}{subsection.8.6.4}%
\contentsline {chapter}{\numberline {第九章\hspace {.3em}}RISC-V Privileged Instruction Set Listings}{167}{chapter.9}%
\contentsline {chapter}{\numberline {第十章\hspace {.3em}}History}{169}{chapter.10}%
\contentsline {section}{\numberline {10.1}Research Funding at UC Berkeley}{169}{section.10.1}%
